#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "vector.h"
#include "banker.h"
void a(int*v1,int*v2,int l){for(int i=-1;++i<l;v1[i]+=v2[i]);}void b(int*v1,int*v2,int l){for(int i=-1;++i<l;v1[i]-=v2[i]);}int c(int*v1,int*v2,int l){int b=1;for(int i=-1;++i<l;b*=(v1[i]<=v2[i]));return b;}int d(int*v,int l){int b=1;for(int i=-1;++i<l;b*=v[i]);return b;}int e(int*g,int**h,int**k,int n,int m,char*o,int*p){if(d(p,n)){printf("SAFE: %s\n",o);return 1;}int sf=0;int s=1;for(int i=-1;++i<n;){if(p[i])continue;if(c(k[i],g,m)){a(g,h[i],m);p[i]=1;sprintf(o,"%sT%u ",o,i);sf=e(g,h,k,n,m,o,p)||sf;s=0;o[strlen(o)-3]='\0';p[i]=0;b(g,h[i],m);}}if(s){sf=0;printf("UNSAFE: ");for(int i=-1;++i<n;printf(!p[i]?"T%u ":"",i));printf("can't finish\n");}return sf;}int isSafe(int*q,int**h,int**r,int n,int m){int*g=(int*)malloc(m*sizeof(int));for(int i=-1;++i<m;g[i]=q[i]);int*p=(int*)calloc(n,sizeof(int));int**k=(int**)malloc(n*sizeof(int*));for(int i=-1;++i<n;){k[i]=(int*)malloc(m*sizeof(int));for(int j=-1;++j<m;k[i][j]=r[i][j]-h[i][j]);}for(int i=-1;++i<n;b(g,h[i],m));char*o=(char*)calloc((n*3),sizeof(char));int sf=e(g,h,k,n,m,o,p);free(o);free(g);free(p);for(int i=-1;++i<n;free(k[i]));free(k);return sf;}
